var user;$("#sidebar").mCustomScrollbar({theme:"minimal"}),$("#dismiss, .overlay").on("click",function(){$("#sidebar").removeClass("active"),$(".overlay").removeClass("active")}),$("#sidebarCollapse").on("click",function(){$("#sidebar").addClass("active"),$(".overlay").addClass("active"),$(".collapse.in").toggleClass("in"),$("a[aria-expanded=true]").attr("aria-expanded","false")}),mapboxgl.accessToken="pk.eyJ1IjoidGhvbWFzMzMiLCJhIjoiY2pzYWFpcXNwMDAxbzN5cGZneGxia3U3ZCJ9.sigYT2nlLnC1siycJ3im-Q";var map=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[4.8320114,45.7578137],zoom:15}),urlAPI="http://localhost/projects/velocity/api";$.ajax({type:"GET",url:"https://api.jcdecaux.com/vls/v1/stations?contract=Lyon&apiKey=18125dec00ffb281d822ceefb633311dc8ba4d7d",success:function(a){a.forEach(function(a){var s=document.createElement("div");s.id="marker";var e={stationId:a.number,stationName:a.name,stationAddress:a.address,stationStatut:a.status,stationPlaces:a.available_bike_stands,stationBikes:a.available_bikes,stationPayment:a.banking};new mapboxgl.Popup({offset:25});$(s).click(function(){$("#exampleModal2").modal("show"),$("#station_name").html(e.stationName),$("#station_adress").html(e.stationAddress),$("#status").html(e.stationStatut),$("#veloDispo").html(e.stationBikes),$("#placeDispo").html(e.stationPlaces),$("#paiementDispo").html(e.stationPayment),$("#formReservation").submit(function(s){s.preventDefault(),console.log(a.number),console.log(user.id),console.log(e),e.stationBikes>0?$.ajax({type:"POST",url:`${urlAPI}/setReservation.php`,data:"stationId="+e.stationId+"&userId="+user.id+"&nb_bikes="+e.stationBikes,success:function(a){e.stationBikes--,e.stationPlaces++,$("#veloDispo").html(e.stationBikes),$("#placeDispo").html(e.stationPlaces),$("footer").show()}}):alert("Réservation impossible ! Aucun vélo disponible")})}),new mapboxgl.Marker(s).setLngLat(a.position).addTo(map)})},error:function(a){console.error()}});urlAPI="http://localhost/projects/velocity/api";$("#formLogin").submit(function(a){a.preventDefault(),serializeFormLogin=$(this).serialize(),$.ajax({type:"post",url:`${urlAPI}/checkUser.php`,data:serializeFormLogin,success:function(a){if(a=JSON.parse(a),user=a,a.username){$("#test").hide(),$(".modal-backdrop").hide(),$(".navbar").show(),$("#map").show();var s=$("#map"),e=$(".mapboxgl-canvas");s.css("width","100%"),e.css("width","100%"),map.resize()}}})});urlAPI="http://localhost/projects/velocity/api";$("#formSignup").submit(function(a){a.preventDefault(),serializeFormSignup=$(this).serialize(),$.ajax({type:"post",url:`${urlAPI}/signUser.php`,data:serializeFormSignup,success:function(a){a=JSON.parse(a),$("#test").hide(),$(".modal-backdrop").hide(),$(".navbar").show(),$("#map").show();var s=$("#map"),e=$(".mapboxgl-canvas");s.css("width","100%"),e.css("width","100%"),map.resize()}})});