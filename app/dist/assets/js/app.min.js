var user;$("#sidebar").mCustomScrollbar({theme:"minimal"}),$("#dismiss, .overlay").on("click",function(){$("#sidebar").removeClass("active"),$(".overlay").removeClass("active")}),$("#sidebarCollapse").on("click",function(){$("#sidebar").addClass("active"),$(".overlay").addClass("active"),$(".collapse.in").toggleClass("in"),$("a[aria-expanded=true]").attr("aria-expanded","false")}),mapboxgl.accessToken="pk.eyJ1IjoidGhvbWFzMzMiLCJhIjoiY2pzYWFpcXNwMDAxbzN5cGZneGxia3U3ZCJ9.sigYT2nlLnC1siycJ3im-Q";var map=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[4.8320114,45.7578137],zoom:15}),urlAPI="http://localhost/projects/velocity/api";function reservationVelo(a,e){event.preventDefault(),quantite=a,formId=e,console.log(quantite),$.ajax({type:"POST",url:`${urlAPI}/setReservation.php`,data:"stationId="+formId+"&userId="+user.id+"&nb_bikes="+quantite,success:function(a){console.log(a),quantite--,marker.available_bikes--,console.log(quantite),$("#formReservation-"+formId).attr("onsubmit","reservationVelo("+quantite+","+formId+")"),$("#veloDispo-"+formId).html(quantite),placesDisponibles=$("#placeDispo-"+formId).html(),placesDisponibles++,$("#placeDispo-"+formId).html(placesDisponibles),quantite<=0&&($(".mapboxgl-popup-content").css("background-color","red"),alert("Plus aucun vélo disponible !"))}})}$.ajax({type:"GET",url:"https://api.jcdecaux.com/vls/v1/stations?contract=Lyon&apiKey=18125dec00ffb281d822ceefb633311dc8ba4d7d",success:function(a){a.forEach(function(a){var e=document.createElement("div");e.id="marker",$(e).attr("data-id",a.number);a.number,a.name,a.address,a.status,a.available_bike_stands,a.available_bikes,a.banking;"OPEN"===a.status?$(".test").css("color","green"):$(".test").css("color","red");var s=new mapboxgl.Popup({offset:25}).setHTML(`\n            <div>\n                <div >\n                    <div >\n                        <div>\n                            <h5 class="modal-title" id="exampleModalLabel-${a.number}">Info Stations</h5>\n                        </div>\n                        <div >\n                            \x3c!-- <div class="mb-3 text-center">\n                                <img src="src/assets/img/velo.png" width="300">\n                            </div> --\x3e\n                            <h3 id="station_name" class="mt-3">${a.name}</h3>\n                            <i class="mr-2 mb-3 fas fa-map-marker-alt"></i><small id="station_adress-${a.number}" class="text-muted"/>${a.address}</small>\n                            <ul>\n                                <li><i class="mr-3 fas fa-sort"></i>Etat : <span class="test" id="status-${a.number}">${a.status}</span> </li>\n                                <li><i class="mr-3 fas fa-bicycle"></i>Vélos disponibles : <span id="veloDispo-${a.number}">${a.available_bikes}</span> </li>\n                                <li><i class="mr-3 fas fa-parking"></i>Places disponibles : <span id="placeDispo-${a.number}">${a.available_bike_stands}</span></li>\n                                <li><i class="mr-3 far fa-credit-card"></i><span id="paiementDispo-${a.number}"></span>${a.banking}</li></li>\n                                \n                            </ul>\n                            <form id="formReservation-${a.number}" class="my-3" action="" onsubmit="reservationVelo(${a.available_bikes}, ${a.number});"  method="post" data-quantite="${a.available_bikes}" data-id="${a.number}">\n                                    <div class="form-group">\n                                        <input type="text" name="firstname" class="form-control" placeholder="Prénom">\n                                    </div>\n                                    <div class="form-group">\n                                        <input type="text" name="lastname" class="form-control" placeholder="Nom">\n                                    </div>\n                                    <div class=-modal-footer>\n                                        <div class="form-group">\n                                            <input type="submit"  name="submitReservation" value="Reserver" class="btn btn-block btn-danger ">\n                                        </div>\n                                    </div>\n                            </form>\n\n                        </div>\n                        \n                    </div>\n                </div>\n            </div>\n            `);new mapboxgl.Marker(e).setLngLat(a.position).setPopup(s).addTo(map)})},error:function(a){console.error()}}),$(document).ready(function(){$("form").on("submit",function(a){a.preventDefault()})});urlAPI="http://localhost/projects/velocity/api";$("#formLogin").submit(function(a){a.preventDefault(),serializeFormLogin=$(this).serialize(),$.ajax({type:"post",url:`${urlAPI}/checkUser.php`,data:serializeFormLogin,success:function(a){if(a=JSON.parse(a),user=a,a.username){$("#test").hide(),$(".modal-backdrop").hide(),$(".navbar").show(),$("#map").show();var e=$("#map"),s=$(".mapboxgl-canvas");e.css("width","100%"),s.css("width","100%"),map.resize()}}})});urlAPI="http://localhost/projects/velocity/api";$("#formSignup").submit(function(a){a.preventDefault(),serializeFormSignup=$(this).serialize(),$.ajax({type:"post",url:`${urlAPI}/signUser.php`,data:serializeFormSignup,success:function(a){a=JSON.parse(a),$("#test").hide(),$(".modal-backdrop").hide(),$(".navbar").show(),$("#map").show();var e=$("#map"),s=$(".mapboxgl-canvas");e.css("width","100%"),s.css("width","100%"),map.resize()}})});