var user;$("#sidebar").mCustomScrollbar({theme:"minimal"}),$("#dismiss, .overlay").on("click",function(){$("#sidebar").removeClass("active"),$(".overlay").removeClass("active")}),$("#sidebarCollapse").on("click",function(){$("#sidebar").addClass("active"),$(".overlay").addClass("active"),$(".collapse.in").toggleClass("in"),$("a[aria-expanded=true]").attr("aria-expanded","false")}),mapboxgl.accessToken="pk.eyJ1IjoidGhvbWFzMzMiLCJhIjoiY2pzYWFpcXNwMDAxbzN5cGZneGxia3U3ZCJ9.sigYT2nlLnC1siycJ3im-Q";var map=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[4.8320114,45.7578137],zoom:15}),secon=0,minu=20,heur=0;function deleteReservation(e){$.ajax({type:"POST",url:`${urlAPI}/deleteReservation.php`,data:"stationId="+formId+"&userId="+user.id+"&nb_bikes="+quantite,success:function(e){console.log(e)}})}function reservationChrono(e){0==secon&&0==minu&&0==heur||(--secon<0&&(secon=59,minu>0?minu--:(minu=59,heur--)),secondes=secon<10?"0"+secon:secon,minutes=minu<10?"0"+minu:minu,heures=heur<10?"0"+heur:heur,0==minu&&0==secon&&deleteReservation(e),document.getElementById("stopwatch").innerHTML=heures+" : "+minutes+" : "+secondes,compte=setTimeout("reservationChrono()",1e3))}var urlAPI="http://localhost/projects/velocity/api";function reservationVelo(e,a){event.preventDefault(),quantite=e,formId=a,console.log(quantite),$.ajax({type:"POST",url:`${urlAPI}/setReservation.php`,data:"stationId="+formId+"&userId="+user.id+"&nb_bikes="+quantite,success:function(e){console.log(e),quantite--,marker.available_bikes--,console.log(quantite),$("#formReservation-"+formId).attr("onsubmit","reservationVelo("+quantite+","+formId+")"),$("#veloDispo-"+formId).html(quantite),placesDisponibles=$("#placeDispo-"+formId).html(),placesDisponibles++,$("#placeDispo-"+formId).html(placesDisponibles),quantite<=0&&($(".mapboxgl-popup-content").css("background-color","red"),alert("Plus aucun vélo disponible !")),reservationChrono(),$("footer").show(12e5)}})}$.ajax({type:"GET",url:"https://api.jcdecaux.com/vls/v1/stations?contract=Lyon&apiKey=18125dec00ffb281d822ceefb633311dc8ba4d7d",success:function(e){e.forEach(function(e){var a=document.createElement("div");a.id="marker",$(a).attr("data-id",e.number);e.number,e.name,e.address,e.status,e.available_bike_stands,e.available_bikes,e.banking;"OPEN"===e.status?$(".test").css("color","green"):$(".test").css("color","red");var s=new mapboxgl.Popup({offset:25}).setHTML(`\n            <div>\n                <div >\n                    <div >\n                        <div>\n                            <h5 class="modal-title" id="exampleModalLabel-${e.number}">Info Stations</h5>\n                        </div>\n                        <div >\n                            \x3c!-- <div class="mb-3 text-center">\n                                <img src="src/assets/img/velo.png" width="300">\n                            </div> --\x3e\n                            <h3 id="station_name" class="mt-3">${e.name}</h3>\n                            <i class="mr-2 mb-3 fas fa-map-marker-alt"></i><small id="station_adress-${e.number}" class="text-muted"/>${e.address}</small>\n                            <ul>\n                                <li><i class="mr-3 fas fa-sort"></i>Etat : <span class="test" id="status-${e.number}">${e.status}</span> </li>\n                                <li><i class="mr-3 fas fa-bicycle"></i>Vélos disponibles : <span id="veloDispo-${e.number}">${e.available_bikes}</span> </li>\n                                <li><i class="mr-3 fas fa-parking"></i>Places disponibles : <span id="placeDispo-${e.number}">${e.available_bike_stands}</span></li>\n                                <li><i class="mr-3 far fa-credit-card"></i><span id="paiementDispo-${e.number}"></span>${e.banking}</li></li>\n                                \n                            </ul>\n                            <form id="formReservation-${e.number}" class="my-3" action="" onsubmit="reservationVelo(${e.available_bikes}, ${e.number});"  method="post" data-quantite="${e.available_bikes}" data-id="${e.number}">\n                                    <div class="form-group">\n                                        <input type="text" name="firstname" class="form-control" placeholder="Prénom">\n                                    </div>\n                                    <div class="form-group">\n                                        <input type="text" name="lastname" class="form-control" placeholder="Nom">\n                                    </div>\n                                    <div class=-modal-footer>\n                                        <div class="form-group">\n                                            <input type="submit"  name="submitReservation" value="Reserver" class="btn btn-block btn-danger ">\n                                        </div>\n                                    </div>\n                            </form>\n\n                        </div>\n                        \n                    </div>\n                </div>\n            </div>\n            `);new mapboxgl.Marker(a).setLngLat(e.position).setPopup(s).addTo(map)})},error:function(e){console.error()}}),$(document).ready(function(){$("form").on("submit",function(e){e.preventDefault()})});urlAPI="http://localhost/projects/velocity/api";$("#formLogin").submit(function(e){e.preventDefault(),serializeFormLogin=$(this).serialize(),$.ajax({type:"post",url:`${urlAPI}/checkUser.php`,data:serializeFormLogin,success:function(e){if(e=JSON.parse(e),user=e,e.username){$("#test").hide(),$(".modal-backdrop").hide(),$(".navbar").show(),$("#map").show();var a=$("#map"),s=$(".mapboxgl-canvas");a.css("width","100%"),s.css("width","100%"),map.resize()}}})});urlAPI="http://localhost/projects/velocity/api";$("#formSignup").submit(function(e){e.preventDefault(),serializeFormSignup=$(this).serialize(),$.ajax({type:"post",url:`${urlAPI}/signUser.php`,data:serializeFormSignup,success:function(e){e=JSON.parse(e),$("#test").hide(),$(".modal-backdrop").hide(),$(".navbar").show(),$("#map").show();var a=$("#map"),s=$(".mapboxgl-canvas");a.css("width","100%"),s.css("width","100%"),map.resize()}})});